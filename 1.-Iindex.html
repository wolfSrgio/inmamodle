<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>imamodle</title>
<style>
    div#res2{
        background: yellow;
    }
</style>
<script>
    var suma=0;
    var arryJugador=new Array();
    var puntos;
    var puntos2;

    function plantarte(){
        suma=0;
        console.log('entra aqui');
        accion('maquina');
    }
     function tratamiento(arrayCarta,arry){
         var sonIguales=false;

         if(arry.length==0){
            arry.push(arrayCarta);
         }
         else{
       
            for(var i=0 ;i<arry.length && !sonIguales;i++){
                if(arry[i][0]==arrayCarta[0] &&arry[i][1]==arrayCarta[1] ){
                    sonIguales=true;  
                  }
             
        }
           if(!sonIguales){
                arry.push(arrayCarta);
            }
            else{ 
                accion('botonJugador');
            }
         }
       
      

         var c=parseFloat(arrayCarta[2]);
         suma+=c;
     
         
        return suma;
     }

     function controlPuntos(){
         console.log(puntos);
         console.log(puntos2);

         if(puntos2<puntos || puntos2>7.5)
             {
              accion('maquina')
             }
             else if(puntos2==7.5){
                console.log("RESULTADO PERFECTO  siete y media");
                console.log('***tu :'+puntos)
             }else if(puntos2>puntos){
                
                console.log('***gano la maquina'+puntos2);
                console.log('***tu :'+puntos)
             }
     }
     
    
        function accion(but)
        {
            console.log(but.id);
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                   
                    var rp=this.responseText;
                    var arrayCarta=rp.split(",");
                    
                    
                    var cadena=document.getElementById("res");
                    var cadena2=document.getElementById("res2");

                    if(but.id=="botonJugador"){
                         puntos=tratamiento(arrayCarta,arryJugador);
                        cadena.innerHTML =`Haz sacado  :
                        ${arrayCarta[1]}  de   ${arrayCarta[0]}`;
                        cadena.innerHTML+="<br>llevas : "+puntos+'<br>';
                       }
                       else{
                        console.log(puntos);
                         puntos2=tratamiento(arrayCarta,arryJugador); 
                        cadena.innerHTML =`La Maquina saco :
                        ${arrayCarta[1]}  de   ${arrayCarta[0]}`;
                        cadena.innerHTML+="<br>lleva : "+puntos2+'<br>';
                         controlPuntos();
                       }
                 
                   
                 
               
                }
            
       
            };
            xmlhttp.open("GET", "declaraciones.php", true);
            xmlhttp.send();
        }
    </script>
</head>
<body>
        <input type="button"  value="Pedir Carta" id="botonJugador" onclick = "accion(this);">
        <input type="button" name="" value="Plantarte" id="boton2" onclick = "plantarte();">
        <div id='res'></div>
        <div id='res2'></div>
</body>
</html>